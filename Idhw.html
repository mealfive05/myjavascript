<html>

<body>
<h1>身份證字號產生器</h1>
<input type="button" value="產生" onclick="produce()">
<select id="a">
    <option value="A">臺北市(A)</option>
    <option value="B">臺中市(B)</option>
    <option value="C">基隆市(C)</option>
    <option value="D">臺南市(D)</option>
    <option value="E">高雄市(E)</option>
    <option value="F">臺北縣(F)</option>
    <option value="G">宜蘭縣(G)</option>
    <option value="H">桃園縣(H)</option>
    <option value="J">新竹縣(J)</option>
    <option value="K">苗栗縣(K)</option>
    <option value="L">臺中縣(L)</option>
    <option value="M">南投縣(M)</option>
    <option value="N">彰化縣(N)</option>
    <option value="P">雲林縣(P)</option>
    <option value="Q">嘉義縣(Q)</option>
    <option value="R">臺南縣(R)</option>
    <option value="S">高雄縣(S)</option>
    <option value="T">屏東縣(T)</option>
    <option value="U">花蓮縣(U)</option>
    <option value="V">臺東縣(V)</option>
    <option value="X">澎湖縣(X)</option>
    <option value="Y">陽明山(Y)</option>
    <option value="W">金門縣(W)</option>
    <option value="Z">連江縣(Z)</option>
    <option value="O">新竹市(O)</option>
    <option value="I">嘉義市(I)</option>
</select>
<select id="b">
    <option value="1">男</option>
    <option value="2">女</option>

</select>
<span id="id"></span>


<hr>
<h2>驗證一下</h2>
<input type="text" id="id2">
<input type="button" value="check" onclick="ckId(id)">



<script>
        
    
        function produce() {
        let eight = Math.floor((Math.random() * 100000001));
        let locat = document.getElementById('a').value;
        let sex = document.getElementById('b').value;
        let id = locat + sex + eight;
            if (checkTWId(id)) {
                document.getElementById('id').innerHTML = id;
            } else {
                produce();
            }
        }
    
        function checkTWId(id) {
            let ret = false;
            let regex = /^[A-Z][12][0-9]{8}$/;  //暴力搜尋法
            let result = id.match(regex);
            if (result != null) {
                let letters = 'ABCDEFGHJKLMNOPQRSTUVXYWZIO';
                let c12 = id.substr(0, 1);
                let n12 = letters.indexOf(c12) + 10;
                let n1 = parseInt(n12 / 10);
                let n2 = n12 % 10;
                let n3 = parseInt(id.substr(1, 1));
                let n4 = parseInt(id.substr(2, 1));
                let n5 = parseInt(id.substr(3, 1));
                let n6 = parseInt(id.substr(4, 1));
                let n7 = parseInt(id.substr(5, 1));
                let n8 = parseInt(id.substr(6, 1));
                let n9 = parseInt(id.substr(7, 1));
                let n10 = parseInt(id.substr(8, 1));
                let n11 = parseInt(id.substr(9, 1));
                let sum = n1 * 1 + n2 * 9 + n3 * 8 + n4 * 7 + n5 * 6 + n6 * 5 + n7 * 4 + n8 * 3 + n9 * 2 + n10 * 1 + n11 * 1;
                ret = sum % 10 == 0;
            }
            return ret;
    
        }
    
        function ckId(){
        let id2=document.getElementById('id2').value;
        let isRight = checkTWId(id2);
        if(!isRight){
            alert('錯誤');
        }else{
            alert('正確');
        }
        
    }
    
    </script>
</body>
</html>